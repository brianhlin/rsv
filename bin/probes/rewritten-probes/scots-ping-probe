#!/usr/bin/env perl

use strict;
use warnings;
use Getopt::Long;

my $VDT_LOCATION;
my $metric;
my $uri;

GetOptions("vdt-location=s" => \$VDT_LOCATION,
           "m=s"           => \$metric,
           "u=s"           => \$uri,
           "help|usage"    => \&usage);

if(!$metric) {
    print "Must supply -m <metric>\n";
    exit 1;
}

if(!$uri) {
    print "Must supply -u <uri>\n";
    exit 1;
}


if(system("which ping >/dev/null 2>&1")) {
    report("UNKNOWN", "ping command not available.  Check PATH");
}

my $ret = system("ping -q -c 1 -W 10 $uri >/dev/null 2>&1");
if($ret) {
    report("CRITICAL", "ping failed.");
}
else {
    report("OK", "ping succeeded");
}


sub report {
    my ($status, $details) = @_;
    print "JOB RESULTS:\n";
    print "$status\n";
    print "$details\n";
    exit 0;
}
